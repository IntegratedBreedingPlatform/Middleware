<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
				   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet author="vanina" id="v6.3-1">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="sample_list" columnName="type"/> </not>
		</preConditions>
		<addColumn tableName="sample_list">
			<column name="type" type="VARCHAR(30)" defaultValue="FOLDER" afterColumn="created_by">
				<constraints nullable="false"/>
			</column>
		</addColumn>
	</changeSet>

	<changeSet author="vanina" id="v6.3-2">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="sample_list"></tableExists>
		</preConditions>
		<sql dbms="mysql" splitStatements="true">
			update sample_list
			set type = 'FOLDER'
			where list_name = 'Samples';
		</sql>
	</changeSet>

	<changeSet author="vanina" id="v6.3-3">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="sample_list" columnName="type"/>
		</preConditions>
		<sql dbms="mysql" splitStatements="true">
			alter table sample_list modify column created_date datetime;
		</sql>
	</changeSet>

	<changeSet author="vanina" id="v6.3-4">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="sample" columnName="created_date"/>
		</preConditions>
		<sql dbms="mysql" splitStatements="true">
			alter table sample modify column created_date datetime;
		</sql>
	</changeSet>

	<changeSet author="vanina" id="v6.3-5">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="sample" columnName="created_by"/></not>
		</preConditions>
		<sql dbms="mysql" splitStatements="true">
			ALTER TABLE sample
			ADD COLUMN created_by INT(11) NOT NULL DEFAULT 1,
			ADD INDEX fk_sample_created_by_idx (created_by ASC);
			ALTER TABLE sample
			ADD CONSTRAINT fk_sample_created_by
			FOREIGN KEY (created_by)
			REFERENCES users (userid)
			ON DELETE NO ACTION
			ON UPDATE NO ACTION;
		</sql>
	</changeSet>

</databaseChangeLog>
