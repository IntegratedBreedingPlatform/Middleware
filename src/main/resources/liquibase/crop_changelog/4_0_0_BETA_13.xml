<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
				   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
				   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">


	<changeSet author="abhishekptl" id="1" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="pedigree"/></not>
		</preConditions>

		<createTable tableName="pedigree">
			<column name="id" type="INT">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="pedigree_string" type="VARCHAR(512)">
				<constraints nullable="false"/>
			</column>
			<column name="algorithm_used" type="VARCHAR(128)">
				<constraints nullable="false"/>
			</column>
			<column name="level_used" type="INT">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<modifySql dbms="mysql">
			<append value="ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE utf8_general_ci"/>
		</modifySql>
	</changeSet>

	<changeSet author="abhishekptl" id="2">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="germplsm" columnName="pedigree_id"/> </not>
		</preConditions>
		<addColumn tableName="germplsm">
			<column name="pedigree_id" type="INT"/>
		</addColumn>
	</changeSet>

	<changeSet author="abhishekptl" id="3">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="germplsm" columnName="pedigree_id"/>
			<tableExists tableName="pedigree"/>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="pedigree_id" baseTableName="germplsm" constraintName="fk_pedigree_id"
								 referencedColumnNames="id" referencedTableName="pedigree"/>
	</changeSet>

</databaseChangeLog>
