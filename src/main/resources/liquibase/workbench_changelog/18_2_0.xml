<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

	<changeSet author="lkovacic" id="v18.2.0-1">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="qrtz_job_details"/>
			</not>
		</preConditions>
		<comment>
            Add 'qrtz_job_details' table
        </comment>
        <sql dbms="mysql" splitStatements="true">
			CREATE TABLE qrtz_job_details (
				SCHED_NAME        VARCHAR(120) NOT NULL,
				JOB_NAME          VARCHAR(200) NOT NULL,
				JOB_GROUP         VARCHAR(200) NOT NULL,
				DESCRIPTION       VARCHAR(250) NULL,
				JOB_CLASS_NAME    VARCHAR(250) NOT NULL,
				IS_DURABLE        VARCHAR(1)   NOT NULL,
				IS_NONCONCURRENT  VARCHAR(1)   NOT NULL,
				IS_UPDATE_DATA    VARCHAR(1)   NOT NULL,
				REQUESTS_RECOVERY VARCHAR(1)   NOT NULL,
				JOB_DATA          BLOB         NULL,
				PRIMARY KEY (SCHED_NAME, JOB_NAME, JOB_GROUP)
			);
        </sql>
	</changeSet>

	<changeSet author="lkovacic" id="v18.2.0-2">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="qrtz_triggers"/>
			</not>
		</preConditions>
		<comment>
            Add 'qrtz_triggers' table
        </comment>
        <sql dbms="mysql" splitStatements="true">
			CREATE TABLE qrtz_triggers (
				SCHED_NAME     VARCHAR(120) NOT NULL,
				TRIGGER_NAME   VARCHAR(200) NOT NULL,
				TRIGGER_GROUP  VARCHAR(200) NOT NULL,
				JOB_NAME       VARCHAR(200) NOT NULL,
				JOB_GROUP      VARCHAR(200) NOT NULL,
				DESCRIPTION    VARCHAR(250) NULL,
				NEXT_FIRE_TIME BIGINT(13)   NULL,
				PREV_FIRE_TIME BIGINT(13)   NULL,
				PRIORITY       INTEGER      NULL,
				TRIGGER_STATE  VARCHAR(16)  NOT NULL,
				TRIGGER_TYPE   VARCHAR(8)   NOT NULL,
				START_TIME     BIGINT(13)   NOT NULL,
				END_TIME       BIGINT(13)   NULL,
				CALENDAR_NAME  VARCHAR(200) NULL,
				MISFIRE_INSTR  SMALLINT(2)  NULL,
				JOB_DATA       BLOB         NULL,
				PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
				FOREIGN KEY (SCHED_NAME, JOB_NAME, JOB_GROUP)
					REFERENCES QRTZ_JOB_DETAILS(SCHED_NAME, JOB_NAME, JOB_GROUP)
			);
        </sql>
	</changeSet>

	<changeSet author="lkovacic" id="v18.2.0-3">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="qrtz_simple_triggers"/>
			</not>
		</preConditions>
		<comment>
            Add 'qrtz_simple_triggers' table
        </comment>
        <sql dbms="mysql" splitStatements="true">
			CREATE TABLE qrtz_simple_triggers (
				SCHED_NAME      VARCHAR(120) NOT NULL,
				TRIGGER_NAME    VARCHAR(200) NOT NULL,
				TRIGGER_GROUP   VARCHAR(200) NOT NULL,
				REPEAT_COUNT    BIGINT(7)    NOT NULL,
				REPEAT_INTERVAL BIGINT(12)   NOT NULL,
				TIMES_TRIGGERED BIGINT(10)   NOT NULL,
				PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
				FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
					REFERENCES QRTZ_TRIGGERS(SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
			);
        </sql>
	</changeSet>

	<changeSet author="lkovacic" id="v18.2.0-4">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="qrtz_paused_trigger_grps"/>
			</not>
		</preConditions>
		<comment>
            Add 'qrtz_paused_trigger_grps' table
        </comment>
        <sql dbms="mysql" splitStatements="true">
			CREATE TABLE qrtz_paused_trigger_grps (
				SCHED_NAME    VARCHAR(120) NOT NULL,
				TRIGGER_GROUP VARCHAR(200) NOT NULL,
				PRIMARY KEY (SCHED_NAME, TRIGGER_GROUP)
			);
        </sql>
	</changeSet>

	<changeSet author="lkovacic" id="v18.2.0-5">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="qrtz_fired_triggers"/>
			</not>
		</preConditions>
		<comment>
            Add 'qrtz_fired_triggers' table
        </comment>
        <sql dbms="mysql" splitStatements="true">
			CREATE TABLE qrtz_fired_triggers (
				SCHED_NAME        VARCHAR(120) NOT NULL,
				ENTRY_ID          VARCHAR(95)  NOT NULL,
				TRIGGER_NAME      VARCHAR(200) NOT NULL,
				TRIGGER_GROUP     VARCHAR(200) NOT NULL,
				INSTANCE_NAME     VARCHAR(200) NOT NULL,
				FIRED_TIME        BIGINT(13)   NOT NULL,
				SCHED_TIME        BIGINT(13)   NOT NULL,
				PRIORITY          INTEGER      NOT NULL,
				STATE             VARCHAR(16)  NOT NULL,
				JOB_NAME          VARCHAR(200) NULL,
				JOB_GROUP         VARCHAR(200) NULL,
				IS_NONCONCURRENT  VARCHAR(1)   NULL,
				REQUESTS_RECOVERY VARCHAR(1)   NULL,
				PRIMARY KEY (SCHED_NAME, ENTRY_ID)
			);
        </sql>
	</changeSet>

	<changeSet author="lkovacic" id="v18.2.0-6">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="job"/>
			</not>
		</preConditions>
		<comment>
            Add 'job' table
        </comment>
        <sql dbms="mysql" splitStatements="true">
			create table job (
				id             int auto_increment
					primary key,
				qrtz_job_id    varchar(255) not null,
				status         varchar(255) not null,
				started_date   timestamp    null,
				completed_date timestamp    null
			);
        </sql>
	</changeSet>

</databaseChangeLog>
