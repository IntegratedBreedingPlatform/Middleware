<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet author="dev-mderamos" id="v24.3.0-1">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'MS_VIEW_GERMPLASM_DETAILS';
            </sqlCheck>
        </preConditions>
        <comment>Add View Germplasm Details permission</comment>
        <sql dbms="mysql" splitStatements="true">
            SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

            INSERT INTO permission (`name`, `description`, `parent_id`, `rank`) VALUES ('MS_VIEW_GERMPLASM_DETAILS', 'View Germplasm Details', @mg_studies_permission_id, 18);

            SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'MS_VIEW_GERMPLASM_DETAILS');

            insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
            insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
            insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
        </sql>
    </changeSet>
</databaseChangeLog>