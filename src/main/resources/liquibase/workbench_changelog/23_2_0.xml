<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
				   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
	<changeSet author="cuenyad" id="v23.2.0-1">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'CREATE_STUDIES';
             </sqlCheck>
 		</preConditions>
		<comment>Create Studies permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('CREATE_STUDIES', 'Create Studies', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'CREATE_STUDIES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-2">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'CLOSE_STUDY';
             </sqlCheck>
 		</preConditions>
		<comment>Close Study permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('CLOSE_STUDY', 'Close Study', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'CLOSE_STUDY');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-3">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'DELETE_STUDY';
             </sqlCheck>
 		</preConditions>
		<comment>Delete Study permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('DELETE_STUDY', 'Delete Study', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'DELETE_STUDY');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-4">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'LOCK_STUDY';
             </sqlCheck>
 		</preConditions>
		<comment>Lock Study permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('LOCK_STUDY', 'Lock Study', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'LOCK_STUDY');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-5">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'GERMPLASM_AND_CHECKS';
             </sqlCheck>
 		</preConditions>
		<comment>Germplasm and Checks permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('GERMPLASM_AND_CHECKS', 'Germplasm and Checks', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-6">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'VIEW_GERMPLASM_AND_CHECKS';
             </sqlCheck>
 		</preConditions>
		<comment>View Germplasm and Checks permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('VIEW_GERMPLASM_AND_CHECKS', 'View Germplasm and Checks', @germplasm_and_checks_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'VIEW_GERMPLASM_AND_CHECKS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-7">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'ADD_ENTRY_DETAILS_VARIABLES';
             </sqlCheck>
 		</preConditions>
		<comment>Add Entry Details Variables permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('ADD_ENTRY_DETAILS_VARIABLES', 'Add Entry Details Variables', @germplasm_and_checks_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'ADD_ENTRY_DETAILS_VARIABLES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-8">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'MODIFY_ENTRY_DETAILS_VALUES';
             </sqlCheck>
 		</preConditions>
		<comment>Modify Entry Details Values permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('MODIFY_ENTRY_DETAILS_VALUES', 'Modify Entry Details Values', @germplasm_and_checks_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'MODIFY_ENTRY_DETAILS_VALUES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-9">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'MODIFY_COLUMNS';
             </sqlCheck>
 		</preConditions>
        <comment>Modify Columns permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('MODIFY_COLUMNS', 'Modify Columns', @germplasm_and_checks_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'MODIFY_COLUMNS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-10">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'REPLACE_GERMPLASM';
             </sqlCheck>
 		</preConditions>
		<comment>Replace Germplasm permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('REPLACE_GERMPLASM', 'Replace Germplasm', @germplasm_and_checks_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'REPLACE_GERMPLASM');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-11">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'ADD_NEW_ENTRIES';
             </sqlCheck>
 		</preConditions>
		<comment>Add New Entries permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('ADD_NEW_ENTRIES', 'Add New Entries', @germplasm_and_checks_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'ADD_NEW_ENTRIES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-12">
		<preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'IMPORT_ENTRY_DETAILS';
             </sqlCheck>
 		</preConditions>
        <comment>Add New Entries permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('IMPORT_ENTRY_DETAILS', 'Import Entry Details', @germplasm_and_checks_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'IMPORT_ENTRY_DETAILS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-13">
		<preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'TREATMENT_FACTORS';
             </sqlCheck>
 		</preConditions>
        <comment>Add Treatment Factors permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('TREATMENT_FACTORS', 'Treatment Factors', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'TREATMENT_FACTORS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-14">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'VIEW_TREATMENT_FACTORS';
             </sqlCheck>
 		</preConditions>
		<comment>View Treatment Factors permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @treatment_factors_id = (SELECT permission_id FROM permission WHERE name = 'TREATMENT_FACTORS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('VIEW_TREATMENT_FACTORS', 'View Treatment Factors', @treatment_factors_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'VIEW_TREATMENT_FACTORS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-15">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'ADD_TREATMENT_FACTORS_VARIABLES';
             </sqlCheck>
 		</preConditions>
		<comment>Add Treatment Factors Variables permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @treatment_factors_id = (SELECT permission_id FROM permission WHERE name = 'TREATMENT_FACTORS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('ADD_TREATMENT_FACTORS_VARIABLES', 'Add Treatment Factors Variables', @treatment_factors_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'ADD_TREATMENT_FACTORS_VARIABLES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-16">
		<preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'EXPERIMENTAL_DESIGN';
             </sqlCheck>
 		</preConditions>
        <comment>Add Experimental Design permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('EXPERIMENTAL_DESIGN', 'Experimental Design', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'EXPERIMENTAL_DESIGN');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-17">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'VIEW_EXPERIMENTAL_DESIGN';
             </sqlCheck>
 		</preConditions>
		<comment>View Experimental Design permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @experimental_design_id = (SELECT permission_id FROM permission WHERE name = 'EXPERIMENTAL_DESIGN');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('VIEW_EXPERIMENTAL_DESIGN', 'View Experimental Design', @experimental_design_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'VIEW_EXPERIMENTAL_DESIGN');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-18">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'GENERATE_EXPERIMENTAL_DESIGN';
             </sqlCheck>
 		</preConditions>
		<comment>Generate Experimental Design permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @experimental_design_id = (SELECT permission_id FROM permission WHERE name = 'EXPERIMENTAL_DESIGN');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('GENERATE_EXPERIMENTAL_DESIGN', 'Generate Experimental Design', @experimental_design_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'GENERATE_EXPERIMENTAL_DESIGN');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-19">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'DELETE_EXPERIMENTAL_DESIGN';
             </sqlCheck>
 		</preConditions>
		<comment>Delete Experimental Design permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @experimental_design_id = (SELECT permission_id FROM permission WHERE name = 'EXPERIMENTAL_DESIGN');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('DELETE_EXPERIMENTAL_DESIGN', 'Delete Experimental Design', @experimental_design_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'DELETE_EXPERIMENTAL_DESIGN');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-20">
		<preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'ENVIRONMENT';
             </sqlCheck>
 		</preConditions>
        <comment>Add Environment permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('ENVIRONMENT', 'Environments', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-21">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'VIEW_ENVIRONMENT';
             </sqlCheck>
 		</preConditions>
		<comment>View Environment permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('VIEW_ENVIRONMENT', 'View Environment', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'VIEW_ENVIRONMENT');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-22">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'ADD_ENVIRONMENTAL_CONDITIONS_VARIABLES';
             </sqlCheck>
 		</preConditions>
		<comment>Add Environmental Conditions Variables permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('ADD_ENVIRONMENTAL_CONDITIONS_VARIABLES', 'Add Environmental Conditions Variables', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'ADD_ENVIRONMENT_CONDITIONS_VARIABLES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-23">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'ADD_ENVIRONMENT_DETAILS_VARIABLES';
             </sqlCheck>
 		</preConditions>
		<comment>Add Environment Details Variables permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('ADD_ENVIRONMENT_DETAILS_VARIABLES', 'Add Environment Details Variables', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'ADD_ENVIRONMENT_DETAILS_VARIABLES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-24">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'MODIFY_ENVIRONMENT_VALUES';
             </sqlCheck>
 		</preConditions>
		<comment>modify Environment Values permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('MODIFY_ENVIRONMENT_VALUES', 'Modify Environment Values', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'MODIFY_ENVIRONMENT_VALUES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-25">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'MODIFY_NUMBER_OF_ENVIRONMENT';
             </sqlCheck>
 		</preConditions>
		<comment>Modify Number of Environment permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('MODIFY_NUMBER_OF_ENVIRONMENT', 'Modify Number of Environment', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'MODIFY_NUMBER_OF_ENVIRONMENT');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-26">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'MANAGE_FILES_ENVIRONMENT';
             </sqlCheck>
 		</preConditions>
		<comment>Manage Files Environment permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('MANAGE_FILES_ENVIRONMENT', 'Manage Files Environment', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_FILES_ENVIRONMENT');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-27">
		<preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'STUDY_SETTINGS';
             </sqlCheck>
 		</preConditions>
        <comment>Add Study Settings permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('STUDY_SETTINGS', 'Study Settings', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'STUDY_SETTINGS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-28">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'VIEW_STUDY_SETTINGS';
             </sqlCheck>
 		</preConditions>
		<comment>View Study Settings permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'STUDY_SETTINGS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('VIEW_STUDY_SETTINGS', 'View Study Settings', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'VIEW_STUDY_SETTINGS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-29">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'ADD_STUDY_SETTINGS_VARIABLES';
             </sqlCheck>
 		</preConditions>
		<comment>Add Study Settings Variables permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'STUDY_SETTINGS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('ADD_STUDY_SETTINGS_VARIABLES', 'Add Study Settings Variables', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'ADD_STUDY_SETTINGS_VARIABLES');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-30">
		<preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'CROSSES_AND_SELECTIONS';
             </sqlCheck>
 		</preConditions>
        <comment>Add Crosses and Selections permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @mg_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'MANAGE_STUDIES');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('CROSSES_AND_SELECTIONS', 'Crosses and Selections', @mg_studies_permission_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'CROSSES_AND_SELECTIONS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-31">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'VIEW_CROSSES_AND_SELECTIONS';
             </sqlCheck>
 		</preConditions>
		<comment>View Crosses and Selections permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'CROSSES_AND_SELECTIONS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('VIEW_CROSSES_AND_SELECTIONS', 'View Crosses and Selections', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'VIEW_CROSSES_AND_SELECTIONS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-32">
         <preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
                 SELECT COUNT(*) FROM PERMISSION P WHERE P.NAME = 'CREATE_LOTS_CROSSES_AND_SELECTIONS';
             </sqlCheck>
 		</preConditions>
		<comment>Create lots Crosses and Selections permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @environment_id = (SELECT permission_id FROM permission WHERE name = 'CROSSES_AND_SELECTIONS');

			INSERT INTO permission (`name`, `description`, `parent_id`) VALUES ('CREATE_LOTS_CROSSES_AND_SELECTIONS', 'Create Lots', @environment_id);

			SET @permission_id = (SELECT permission_id FROM permission WHERE name = 'CREATE_LOTS_CROSSES_AND_SELECTIONS');

			insert into role_type_permission(role_type_id, permission_id, selectable) values (1, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (2, @permission_id , 1);
			insert into role_type_permission(role_type_id, permission_id, selectable) values (3, @permission_id , 1);
 		</sql>
 	</changeSet>

	<changeSet author="cuenyad" id="v23.2.0-33">
         <preConditions onFail="MARK_RAN">
			<and>
            	<sqlCheck expectedResult="0">
                	SELECT count(*) > 1 FROM role_permission rp INNER JOIN permission p ON rp.permission_id = p.permission_id
					WHERE p.name IN ('CREATE_STUDIES', 'CLOSE_STUDY', 'DELETE_STUDY', 'LOCK_STUDY', 'GERMPLASM_AND_CHECKS',
									 'TREATMENT_FACTORS', 'EXPERIMENTAL_DESIGN', 'ENVIRONMENT', 'STUDY_SETTINGS');
            	</sqlCheck>
				<not>
					<tableExists tableName="roles_affected_temporary"></tableExists>
				</not>
			</and>
 		</preConditions>
		<comment>Adding new granular studies permissions in role_permission</comment>
 		<sql dbms="mysql" splitStatements="true">
			SET @create_studies_permission_id = (SELECT permission_id FROM permission WHERE name = 'CREATE_STUDIES');
			SET @close_study_permission_id = (SELECT permission_id FROM permission WHERE name = 'CLOSE_STUDY');
			SET @delete_study_permission_id = (SELECT permission_id FROM permission WHERE name = 'DELETE_STUDY');
			SET @lock_study_permission_id = (SELECT permission_id FROM permission WHERE name = 'LOCK_STUDY');
			SET @germplasm_and_checks_permission_id = (SELECT permission_id FROM permission WHERE name = 'GERMPLASM_AND_CHECKS');
			SET @treatment_factors_permission_id = (SELECT permission_id FROM permission WHERE name = 'TREATMENT_FACTORS');
			SET @experimental_design_permission_id = (SELECT permission_id FROM permission WHERE name = 'EXPERIMENTAL_DESIGN');
			SET @environment_permission_id = (SELECT permission_id FROM permission WHERE name = 'ENVIRONMENT');
			SET @study_settings_permission_id = (SELECT permission_id FROM permission WHERE name = 'STUDY_SETTINGS');
			SET @crosses_and_selections_permission_id = (SELECT permission_id FROM permission WHERE name = 'CROSSES_AND_SELECTIONS');

			#Create roles_affected_temporary Table
			CREATE TEMPORARY TABLE roles_affected_temporary (
				role_id int(11) not null
			);

			#Insert role id in Temporary table
			INSERT INTO roles_affected_temporary (role_id)
			SELECT DISTINCT(rp.role_id) FROM role_permission rp INNER JOIN  permission p ON rp.permission_id = p.permission_id
			WHERE p.name IN ('MS_MANAGE_OBSERVATION_UNITS','MS_WITHDRAW_INVENTORY',
							 'MS_CREATE_PENDING_WITHDRAWALS','MS_CREATE_CONFIRMED_WITHDRAWALS',
							 'MS_CANCEL_PENDING_TRANSACTIONS','MS_MANAGE_FILES','MS_CREATE_LOTS')
			GROUP BY rp.role_id;

			#Insert permissions in role_permission
			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @create_studies_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @close_study_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @delete_study_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @lock_study_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @germplasm_and_checks_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @treatment_factors_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @experimental_design_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @environment_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @study_settings_permission_id FROM roles_affected_temporary rp;

			INSERT INTO role_permission(role_id, permission_id)
			SELECT rp.role_id, @crosses_and_selections_permission_id FROM roles_affected_temporary rp;

			#Delete roles_affected_temporary Table
			DROP TABLE roles_affected_temporary;

 		</sql>
 	</changeSet>
</databaseChangeLog>
