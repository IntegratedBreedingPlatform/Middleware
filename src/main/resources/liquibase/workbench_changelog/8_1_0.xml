<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	
	<!-- Cannot drop workbench_project_user_role table because it is being used by "beta16-1" Liquibase script.
		 Dropping the table causes a Liquibase error for new crops hence we just empty the table with the script below.
	 -->
	<changeSet author="darla" id="v8.1.0-1">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="1">
				SELECT COUNT(*) FROM workbench_project_user_role;
			</sqlCheck>
		</preConditions>
		<sql dbms="mysql" splitStatements="true">
			DELETE FROM workbench_project_user_role;
		</sql>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-2">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="1">SELECT count(*) FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE TABLE_NAME = 'workbench_project_user_role' AND CONSTRAINT_NAME='fk_project_user_role_2' and TABLE_SCHEMA = DATABASE();</sqlCheck>
		</preConditions>
	    <dropForeignKeyConstraint baseTableName="workbench_project_user_role" constraintName="fk_project_user_role_2"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-3">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_role"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_role"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-4">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_project_workflow_step"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_project_workflow_step"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-5">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_workflow_step_tool"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_workflow_step_tool"/>
	</changeSet>

    <changeSet author="darla" id="v8.1.0-6">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_workflow_template_step"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_workflow_template_step"/>
	</changeSet>
		
	<changeSet author="darla" id="v8.1.0-7">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_workflow_step"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_workflow_step"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-8">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_workflow_template"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_workflow_template"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-9">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_dataset"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_dataset"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-10">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_tool_input"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_tool_input"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-11">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_tool_output"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_tool_output"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-12">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_tool_transform"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_tool_transform"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-13">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_tool_config"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_tool_config"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-14">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_tool_license_info"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_tool_license_info"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-15">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_runtime_data"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_runtime_data"/>
	</changeSet>
	
	<changeSet author="darla" id="v8.1.0-16">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="workbench_security_question"/>
		</preConditions>
		<dropTable cascadeConstraints="true"  tableName="workbench_security_question"/>
	</changeSet>
	
	
</databaseChangeLog>
